<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estoque Mercado</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Mercadinho</h1>
            <p class="subtitle">ðŸ“¦ Controle de Estoque</p>
        </header>
        
        <div class="card">
            <h3>Novo Produto</h3>
            <div class="form-grid">
                <div class="input-group">
                    <label for="nome">Produto</label>
                    <input type="text" id="nome" placeholder="Ex: Arroz 5kg">
                </div>
                
                <div class="input-group">
                    <label for="preco">PreÃ§o (R$)</label>
                    <input type="number" id="preco" placeholder="0.00" step="0.01">
                </div>
                
                <div class="input-group">
                    <label for="qtd">Qtd</label>
                    <input type="number" id="qtd" placeholder="0">
                </div>
                
                <button class="btn-primary" onclick="salvarProduto()">Adicionar</button>
            </div>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th width="10%">ID</th>
                        <th width="40%">Nome</th>
                        <th width="20%">PreÃ§o</th>
                        <th width="15%">Estoque</th>
                        <th width="15%" class="text-right">AÃ§Ãµes</th>
                    </tr>
                </thead>
                <tbody id="tabela-corpo">
                    </tbody>
            </table>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3000/produtos';

        async function carregarProdutos() {
            try {
                const res = await fetch(API_URL);
                const produtos = await res.json();
                const tbody = document.getElementById('tabela-corpo');
                tbody.innerHTML = '';

                if(produtos.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding: 2rem; color: #888;">Nenhum produto cadastrado.</td></tr>';
                    return;
                }

                produtos.forEach(p => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>#${p.id}</td>
                        <td style="font-weight: 500;">${p.nome}</td>
                        <td>R$ ${parseFloat(p.preco).toFixed(2)}</td>
                        <td>
                            <span style="background: ${p.qtd < 10 ? '#fee2e2' : '#d1fae5'}; color: ${p.qtd < 10 ? '#b91c1c' : '#047857'}; padding: 4px 8px; border-radius: 12px; font-size: 0.85rem;">
                                ${p.qtd} un
                            </span>
                        </td>
                        <td class="text-right">
                            <button class="btn-danger" onclick="deletarProduto(${p.id})">Excluir</button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (error) {
                console.error("Erro ao carregar:", error);
            }
        }

        async function salvarProduto() {
            const nomeInp = document.getElementById('nome');
            const precoInp = document.getElementById('preco');
            const qtdInp = document.getElementById('qtd');

            if (!nomeInp.value || !precoInp.value || !qtdInp.value) return alert('Preencha todos os campos!');

            const payload = {
                nome: nomeInp.value,
                preco: parseFloat(precoInp.value),
                qtd: parseInt(qtdInp.value)
            };

            await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            nomeInp.value = '';
            precoInp.value = '';
            qtdInp.value = '';
            carregarProdutos();
        }

        async function deletarProduto(id) {
            if(confirm('Tem certeza que deseja remover este item?')) {
                await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
                carregarProdutos();
            }
        }

        carregarProdutos();
    </script>
</body>
</html>